<script setup>
import Desk from "@/components/Desk.vue";
</script>
<template>
<svg width="1800.0000000000005" height="900.0000000000002" xmlns="http://www.w3.org/2000/svg">
 <defs>
  <filter id="svg_21_blur">
   <feGaussianBlur in="SourceGraphic" stdDeviation="0"/>
  </filter>
 </defs>

  <title>Layer 1</title>
  <line stroke="#000" fill="none" x1="17" y1="544.85696" x2="17" y2="869.0808" id="svg_5" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <line stroke="#000" fill="none" x1="18.62617" y1="693.57434" x2="80.53099" y2="693.57434" id="svg_256"/>
  <line fill="none" x1="1569.65662" y1="679.32521" x2="1633.06002" y2="679.32521" id="svg_336" stroke="#000"/>
  <line stroke="#000" fill="none" x1="1769.58817" y1="53.85561" x2="1769.58817" y2="98.52832" id="svg_19" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <text fill="#000000" stroke="#000" x="1621.65007" y="780.08248" id="svg_88" stroke-width="0" font-size="24" font-family="Noto Sans JP" text-anchor="start" xml:space="preserve">Bathroom</text>
  <line stroke="#000" fill="none" x1="1348.54154" y1="378.35831" x2="1348.54154" y2="54.69868" id="svg_261"/>
  <line stroke="#000" fill="none" x1="1718.36658" y1="380.45383" x2="1768.24476" y2="380.45383" id="svg_263"/>
  <line fill="none" x1="17.08416" y1="362.89521" x2="17.08416" y2="118.71216" id="svg_601" stroke-dasharray="5,5" stroke="#000"/>
  <line stroke="#000" fill="none" x1="1516.88832" y1="869.3908" x2="1769.84474" y2="869.3908" id="svg_604" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <line stroke="#000" fill="none" x1="1771.01674" y1="513.8539" x2="1771.01674" y2="869.0818" id="svg_607" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <line stroke="#000" fill="none" x1="881.04154" y1="380.05047" x2="881.04154" y2="52.35138" id="svg_707"/>
  <line stroke="#000" fill="none" x1="18.24929" y1="52.33351" x2="76.91021" y2="52.33351" id="svg_809"/>
  <line stroke="#000" fill="none" x1="839.1482" y1="52.3674" x2="86.70132" y2="52.3674" id="svg_1031" stroke-dasharray="5,5"/>
  <line fill="none" x1="1714.38817" y1="52.53678" x2="1769.84473" y2="52.53678" id="svg_1032" stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000"/>
  <line fill="none" x1="1711.14312" y1="680.67656" x2="1771.84382" y2="680.67656" id="svg_1176" stroke="#000"/>
  <line stroke="#000" fill="none" x1="276.14119" y1="870.66494" x2="1516.47633" y2="870.66494" id="svg_1177" stroke-linejoin="undefined" stroke-linecap="undefined" stroke-dasharray="5,5"/>
  <line stroke="#000" fill="none" x1="17.35135" y1="869.3908" x2="270.56304" y2="869.3908" id="svg_1178" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <line stroke="#000" fill="none" x1="17.08416" y1="114.42325" x2="17.08416" y2="51.94106" id="svg_1299"/>
  <line stroke="#000" fill="none" x1="228.83553" y1="867.80338" x2="228.83553" y2="694.13899" id="svg_1563"/>
  <text fill="#000000" stroke="#000" x="74.38762" y="789.20405" id="svg_1565" stroke-width="0" font-size="24" font-family="Noto Sans JP" text-anchor="start" xml:space="preserve">Bathroom</text>
  <line stroke="#000" fill="none" x1="1712.56041" y1="52.3674" x2="1403.5934" y2="52.3674" id="svg_1566" stroke-dasharray="5,5"/>
  <line stroke="#000" fill="none" x1="1769.58817" y1="101.23823" x2="1769.58817" y2="332.8755" id="svg_1569" stroke-linejoin="undefined" stroke-linecap="undefined" stroke-dasharray="5,5"/>
  <line stroke="#000" fill="none" x1="1281.28" y1="52.53678" x2="1416.46637" y2="52.53678" id="svg_1570" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <line fill="none" x1="1571.01695" y1="680.10356" x2="1571.01695" y2="869.08179" id="svg_1" stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000"/>
  <line stroke="#000" fill="none" x1="1769.58817" y1="341.35561" x2="1769.58817" y2="407.27832" id="svg_312" stroke-linejoin="undefined" stroke-linecap="undefined"/>
  <line fill="none" x1="17.08416" y1="465.67324" x2="17.08416" y2="372.77438" id="svg_313" stroke="#000"/>
  <line stroke="#000" fill="none" x1="137.37617" y1="693.57434" x2="228.03099" y2="693.57434" id="svg_396"/>
  <line stroke="#000" fill="none" x1="1277.56039" y1="52.3674" x2="943.5934" y2="52.3674" id="svg_59" stroke-dasharray="5,5"/>
  <line stroke="#000" fill="none" x1="845.7493" y1="52.33351" x2="939.41021" y2="52.33351" id="svg_60"/>
  <line stroke="#000" fill="none" x1="998.36661" y1="380.45383" x2="1655.74481" y2="380.45383" id="svg_61"/>
  <line stroke="#000" fill="none" x1="880.86664" y1="380.45383" x2="940.74476" y2="380.45383" id="svg_62"/>
  <g id="meeting_room">
   <rect stroke="#000" fill="#f2efef" x="989.75789" y="132.65516" width="264.95057" height="170.36876" id="svg_4" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1066.63754" y="158.94242" width="115.55446" height="115.55446" id="svg_48" rx="8"/>
   <rect :fill="(occupiedDesks.includes('4503ee07-8ce8-4c23-94b0-34e5b8fda0aa') || userType !== 'business') ? 'red' : 'green'" x="1070.34121" y="162.64609" width="108.14713" height="108.14713" id="svg_49" rx="8" stroke="#000" data-id="4503ee07-8ce8-4c23-94b0-34e5b8fda0aa" @click="handleMeetingRoomClick"/>
   <rect fill="#f2efef" stroke="#000" x="1022.79589" y="112.05764" width="43.74976" height="21.24988" id="svg_50" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1027.35709" y="303.30658" width="43.74976" height="21.24988" id="svg_51" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1102.35668" y="303.30658" width="43.74976" height="21.24988" id="svg_52" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="963.97956" y="189.15178" width="24.99986" height="48.74973" id="svg_53" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1253.97782" y="188.40856" width="24.99986" height="48.74973" id="svg_54" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1102.52563" y="112.05764" width="43.74976" height="21.24988" id="svg_55" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1175.73509" y="302.8009" width="43.74976" height="21.24988" id="svg_56" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1175.4986" y="112.05764" width="43.74976" height="21.24988" id="svg_57" rx="8"/>
  </g>
  <g id="meeting_room">
   <rect stroke="#000" fill="#f2efef" x="1432.25789" y="131.40516" width="264.95057" height="170.36876" id="svg_610" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1509.13754" y="157.69242" width="115.55446" height="115.55446" id="svg_611" rx="8"/>
   <rect :fill="(occupiedDesks.includes('75ae76bd-de0d-436c-b0d9-ca051b2d3836') || userType !== 'business') ? 'red' : 'green'" x="1512.84121" y="161.39609" width="108.14713" height="108.14713" id="svg_612" rx="8" stroke="#000" data-id="75ae76bd-de0d-436c-b0d9-ca051b2d3836" @click="handleMeetingRoomClick"/>
   <rect fill="#f2efef" stroke="#000" x="1465.29589" y="110.80764" width="43.74976" height="21.24988" id="svg_616" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1469.85709" y="302.05658" width="43.74976" height="21.24988" id="svg_620" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1544.85668" y="302.05658" width="43.74976" height="21.24988" id="svg_621" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1406.47956" y="187.90178" width="24.99986" height="48.74973" id="svg_623" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1696.47782" y="187.15856" width="24.99986" height="48.74973" id="svg_624" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1545.02563" y="110.80764" width="43.74976" height="21.24988" id="svg_1093" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1618.23509" y="301.5509" width="43.74976" height="21.24988" id="svg_1094" rx="8"/>
   <rect fill="#f2efef" stroke="#000" x="1617.9986" y="110.80764" width="43.74976" height="21.24988" id="svg_1561" rx="8"/>
  </g>

    <Desk v-for="desk in desks" :desk="desk" @deskClicked="$emit('deskClicked', $event)"
      :isOccupied="occupiedDesks.includes(desk.id)"></Desk>
  </svg>
</template>
<script>
export default {
  props: {
    floorInfo: {
      type: Object,
      required: true
    },
    occupiedDesks: {
      type: Array
    },
    userType: {
      type: String
    }
  },
  data() {
    return {
      desks: [],
    }
  },
  beforeMount() {
    console.log(this.floorInfo)
    this.getDesks();
  },
  methods: {
    getDesks() {
      this.$ApiService.get_workstations(this.floorInfo.floorId, this.floorInfo.buildingId).then((response) => {
        this.desks = response.data.workStationResourceList.filter((desk) => desk.numberOfSeats === 1);
      });
    },
    handleMeetingRoomClick(event) {
      if (this.userType === 'business') {
        const meetingRoomId = event.target.getAttribute("data-id");
        if (meetingRoomId && !this.occupiedDesks.includes(meetingRoomId)) {
          this.$emit('deskClicked', meetingRoomId);
        }
      }
    }
  }
}
</script>