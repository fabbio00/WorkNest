<script setup>
import Desk from "@/components/Desk.vue";
</script>
<template>
  <svg width="1800" height="900" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <filter id="svg_21_blur">
        <feGaussianBlur in="SourceGraphic" stdDeviation="0" />
      </filter>
    </defs>
    <title>Layer 1</title>

    <title>Layer 1</title>
    <line fill="none" x1="17" y1="342.99918" x2="17" y2="619.08227" id="svg_5" stroke-linejoin="undefined"
      stroke-linecap="undefined" stroke="#000" />
    <line fill="none" x1="15.99999" y1="869.3908" x2="135.56381" y2="869.3908" id="svg_7" stroke-linejoin="undefined"
      stroke-linecap="undefined" stroke="#000" />
    <line fill="none" x1="17" y1="53" x2="182.53076" y2="53" id="svg_253" stroke="#000" />
    <line fill="none" x1="282.13953" y1="53" x2="509.01072" y2="53" id="svg_256" stroke="#000" />
    <line fill="none" x1="478.00174" y1="52.66719" x2="478.00174" y2="185.37557" id="svg_258" stroke="#000" />
    <line fill="none" x1="16.18103" y1="377.39529" x2="477.94218" y2="377.39529" id="svg_333" stroke="#000" />
    <line fill="none" x1="1769.8988" y1="53.33386" x2="1537.79232" y2="53.33386" id="svg_335" stroke="#000" />
    <line fill="none" x1="17.09013" y1="507.63729" x2="211.5746" y2="507.63729" id="svg_336" stroke="#000" />
    <line fill="none" x1="477.69728" y1="245.09127" x2="477.69728" y2="378.30331" id="svg_338" stroke="#000" />
    <line fill="none" stroke="#000" x1="17.71908" y1="725.24955" x2="17.71908" y2="868.95616" id="svg_595"
      stroke-linejoin="undefined" stroke-linecap="undefined" />
    <line fill="none" x1="1769.58817" y1="456.71161" x2="1769.58817" y2="591.93972" id="svg_597"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" />
    <line fill="none" x1="1541.32801" y1="53.33386" x2="507.79522" y2="53.33386" id="svg_598" stroke="#000"
      stroke-dasharray="5,5" />
    <line fill="none" stroke="#000" x1="17.08416" y1="100.20019" x2="17.08416" y2="51.941" id="svg_600" />
    <line fill="none" x1="17.08416" y1="343.05667" x2="17.08416" y2="99.08373" id="svg_601" stroke="#000"
      stroke-dasharray="5,5" />
    <line fill="none" x1="1105.99683" y1="867.96223" x2="1232.70339" y2="867.96223" id="svg_602"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" />
    <line fill="none" x1="1643.13817" y1="869.3908" x2="1769.84473" y2="869.3908" id="svg_604"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" />
    <line fill="none" x1="1237.425" y1="867.96223" x2="1641.27368" y2="867.96223" id="svg_605"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" stroke-dasharray="5,5" />
    <line fill="none" x1="136.65709" y1="868.73151" x2="1108.19738" y2="868.73151" id="svg_606"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke-dasharray="5,5" stroke="#000" />
    <line fill="none" x1="1771.01674" y1="783.85361" x2="1771.01674" y2="869.08184" id="svg_607"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" />
    <line fill="none" x1="1769.58817" y1="596.71125" x2="1769.58817" y2="780.51067" id="svg_608"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" stroke-dasharray="5,5" />
    <line fill="none" stroke="#000" x1="211.36932" y1="507.73217" x2="211.36932" y2="459.47298" id="svg_84" />
    <line fill="none" stroke="#000" x1="211.36932" y1="507.73217" x2="211.36932" y2="459.47298" id="svg_85" />
    <line fill="none" stroke="#000" x1="211.36932" y1="425.91357" x2="211.36932" y2="377.65438" id="svg_87" />
    <text fill="#000000" stroke="#000" x="67.73222" y="451.36825" id="svg_88" stroke-width="0" font-size="24"
      font-family="Noto Sans JP" text-anchor="start" xml:space="preserve">Bathroom</text>
    <line fill="none" x1="1569.25288" y1="53.79045" x2="1569.25288" y2="270.1552" id="svg_249" stroke="#000" />
    <line fill="none" x1="1704.70819" y1="270.1552" x2="1769.3686" y2="270.1552" id="svg_255" stroke="#000" />
    <line fill="none" x1="1570.16205" y1="270.1552" x2="1641.18612" y2="270.1552" id="svg_257" stroke="#000" />
    <text fill="#000000" stroke="#000" x="1623.7986" y="167.42739" id="svg_260" stroke-width="0" font-size="24"
      font-family="Noto Sans JP" text-anchor="start" xml:space="preserve">Bathroom</text>
    <line fill="none" stroke="#000" x1="1170.42664" y1="867.26389" x2="1170.42664" y2="522.71667" id="svg_261" />
    <line fill="none" x1="1171.33579" y1="522.71667" x2="1460.6726" y2="522.71667" id="svg_263" stroke="#000" />
    <line fill="none" x1="1581.3351" y1="522.71667" x2="1769.24351" y2="522.71667" id="svg_267" stroke="#000" />
    <line fill="none" x1="1769.58817" y1="53.85561" x2="1769.58817" y2="331.94051" id="svg_19"
      stroke-linejoin="undefined" stroke-linecap="undefined" stroke="#000" />
    <g id="meeting_room">
      <rect fill="#f2efef" x="1277.01646" y="621.84173" width="383.70008" height="170.36876" id="svg_610" stroke="#000"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1410.34855" y="650.73035" width="115.55446" height="115.55446" id="svg_611"
        rx="8" />
      <rect :fill="(occupiedDesks.includes('7ac68b59-f717-43e8-b629-bff0fdd9da74') || userType !== 'business') ? 'red' : 'green'" x="1414.05222" y="654.43402" width="108.14713" height="108.14713" id="svg_612" rx="8" stroke="#000" data-id="7ac68b59-f717-43e8-b629-bff0fdd9da74" @click="handleMeetingRoomClick" />
      <rect fill="#f2efef" stroke="#000" x="1299.98788" y="599.99421" width="43.74976" height="21.24988" id="svg_613"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1374.98747" y="599.99421" width="43.74976" height="21.24988" id="svg_614"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1448.73706" y="599.99421" width="43.74976" height="21.24988" id="svg_615"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1523.73665" y="599.99421" width="43.74976" height="21.24988" id="svg_616"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1596.23625" y="599.99421" width="43.74976" height="21.24988" id="svg_617"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1306.23784" y="792.49315" width="43.74976" height="21.24988" id="svg_618"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1381.23743" y="792.49315" width="43.74976" height="21.24988" id="svg_619"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1454.98702" y="792.49315" width="43.74976" height="21.24988" id="svg_620"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1529.98661" y="792.49315" width="43.74976" height="21.24988" id="svg_621"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1602.48622" y="792.49315" width="43.74976" height="21.24988" id="svg_622"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1251.23815" y="681.24377" width="24.99986" height="48.74973" id="svg_623"
        rx="8" />
      <rect fill="#f2efef" stroke="#000" x="1661.23589" y="681.24377" width="24.99986" height="48.74973" id="svg_624"
        rx="8" />
    </g>
    <Desk v-for="desk in desks" :desk="desk" @deskClicked="$emit('deskClicked', $event)"
      :isOccupied="occupiedDesks.includes(desk.id)"></Desk>
  </svg>
</template>
<script>
export default {
  props: {
    floorInfo: {
      type: Object,
      required: true
    },
    occupiedDesks: {
      type: Array
    },
    userType: {
      type: String
    }
  },
  data() {
    return {
      desks: [],
    }
  },
  beforeMount() {
    console.log(this.floorInfo)
    this.getDesks();
  },
  methods: {
    getDesks() {
      this.$ApiService.get_workstations(this.floorInfo.floorId, this.floorInfo.buildingId).then((response) => {
        this.desks = response.data.workStationResourceList.filter((desk) => desk.numberOfSeats === 1);
      });
    },
    handleMeetingRoomClick(event) {
      if (this.userType === 'business') {
        const meetingRoomId = event.target.getAttribute("data-id");
        if (meetingRoomId && !this.occupiedDesks.includes(meetingRoomId)) {
          this.$emit('deskClicked', meetingRoomId);
        }
      }
    }
  }
}
</script>